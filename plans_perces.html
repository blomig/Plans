<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Générateur de plans percés</title>
    <style>
        canvas { border: 1px solid black; }
        body { display: flex; flex-direction: column; align-items: center; padding: 20px; }
        label { margin: 5px; }
        button { margin: 5px; }
        #paramString { 
            margin-top: 10px; 
            padding: 5px; 
            border: 1px solid #ccc; 
            background-color: #f9f9f9;
            cursor: pointer; /* Indique que le texte est cliquable pour copier */
        }
        #paramString:hover { background-color: #e9e9e9; }
    </style>
</head>
<body>
    <h1>Générateur de plans percés</h1>
    <h3>Plan 1 (arrière)</h3>
    <label for="d1">Diamètre des trous (D1) : </label>
    <input type="number" id="d1" value="20" min="5" max="50">
    <label for="e1">Espacement (E1) : </label>
    <input type="number" id="e1" value="60" min="20" max="200">
    <label for="color1">Couleur Plan 1 (HEX) : </label>
    <input type="text" id="color1" value="#555555" pattern="#[0-9A-Fa-f]{6}">
    <h3>Plan 2 (avant)</h3>
    <label for="d2">Diamètre des trous (D2) : </label>
    <input type="number" id="d2" value="15" min="5" max="50">
    <label for="e2">Espacement (E2) : </label>
    <input type="number" id="e2" value="50" min="20" max="200">
    <label for="color2">Couleur Plan 2 (HEX) : </label>
    <input type="text" id="color2" value="#BBBBBB" pattern="#[0-9A-Fa-f]{6}">
    <h3>Rotation</h3>
    <label for="angle">Angle entre les plans (degrés) : </label>
    <input type="number" id="angle" value="0" min="0" max="360">
    <h3>Fond</h3>
    <label for="bgColor">Couleur du fond (HEX) : </label>
    <input type="text" id="bgColor" value="#FFFFFF" pattern="#[0-9A-Fa-f]{6}">
    <button onclick="drawPlans()">Générer</button>
    <button onclick="randomize()">Aléatoire</button>
    <canvas id="myCanvas" width="800" height="600"></canvas>
    <p id="paramString" onclick="copyToClipboard()">Cliquez pour copier les paramètres : <span id="paramValues"></span></p>

    <script>
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');
        const OVERFLOW_FACTOR = 2;

        function drawPlans() {
            const D1 = parseFloat(document.getElementById('d1').value);
            const E1 = parseFloat(document.getElementById('e1').value);
            const D2 = parseFloat(document.getElementById('d2').value);
            const E2 = parseFloat(document.getElementById('e2').value);
            const angle = parseFloat(document.getElementById('angle').value) * Math.PI / 180;
            const bgColor = document.getElementById('bgColor').value;
            const color1 = document.getElementById('color1').value;
            const color2 = document.getElementById('color2').value;

            const tempCanvas1 = document.createElement('canvas');
            tempCanvas1.width = canvas.width * OVERFLOW_FACTOR;
            tempCanvas1.height = canvas.height * OVERFLOW_FACTOR;
            const tempCtx1 = tempCanvas1.getContext('2d');

            const tempCanvas2 = document.createElement('canvas');
            tempCanvas2.width = canvas.width * OVERFLOW_FACTOR;
            tempCanvas2.height = canvas.height * OVERFLOW_FACTOR;
            const tempCtx2 = tempCanvas2.getContext('2d');

            ctx.fillStyle = bgColor;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            tempCtx1.fillStyle = color1;
            tempCtx1.fillRect(0, 0, tempCanvas1.width, tempCanvas1.height);
            punchHoles(tempCtx1, D1, E1, 0, tempCanvas1.width, tempCanvas1.height);

            tempCtx2.fillStyle = color2;
            tempCtx2.fillRect(0, 0, tempCanvas2.width, tempCanvas2.height);
            punchHoles(tempCtx2, D2, E2, angle, tempCanvas2.width, tempCanvas2.height);

            const offsetX = (tempCanvas1.width - canvas.width) / 2;
            const offsetY = (tempCanvas1.height - canvas.height) / 2;
            ctx.drawImage(tempCanvas1, offsetX, offsetY, canvas.width, canvas.height, 0, 0, canvas.width, canvas.height);
            ctx.drawImage(tempCanvas2, offsetX, offsetY, canvas.width, canvas.height, 0, 0, canvas.width, canvas.height);
        }

        function punchHoles(context, diameter, spacing, rotationAngle, canvasWidth, canvasHeight) {
            const height = spacing * Math.sin(Math.PI / 3);
            const centerX = canvasWidth / 2;
            const centerY = canvasHeight / 2;

            context.globalCompositeOperation = 'destination-out';
            context.fillStyle = 'black';

            const maxExtent = Math.max(canvasWidth, canvasHeight) / spacing + 5;
            for (let i = -maxExtent; i <= maxExtent; i++) {
                for (let j = -maxExtent; j <= maxExtent; j++) {
                    let x = i * spacing + (j % 2) * spacing / 2;
                    let y = j * height;
                    const rotatedX = centerX + (x * Math.cos(rotationAngle) - y * Math.sin(rotationAngle));
                    const rotatedY = centerY + (x * Math.sin(rotationAngle) + y * Math.cos(rotationAngle));
                    context.beginPath();
                    context.arc(rotatedX, rotatedY, diameter / 2, 0, 2 * Math.PI);
                    context.fill();
                }
            }
            context.globalCompositeOperation = 'source-over';
        }

        function randomize() {
            const D1 = Math.floor(Math.random() * (50 - 5 + 1)) + 5;
            const E1 = Math.floor(Math.random() * (200 - (D1 + 1) + 1)) + (D1 + 1);
            document.getElementById('d1').value = D1;
            document.getElementById('e1').value = E1;

            const D2 = Math.floor(Math.random() * (50 - 5 + 1)) + 5;
            const E2 = Math.floor(Math.random() * (200 - (D2 + 1) + 1)) + (D2 + 1);
            document.getElementById('d2').value = D2;
            document.getElementById('e2').value = E2;

            const angle = Math.floor(Math.random() * 361);
            document.getElementById('angle').value = angle;

            document.getElementById('bgColor').value = '#FFFFFF';

            const color1 = '#' + Math.floor(Math.random() * 16777216).toString(16).padStart(6, '0');
            const color2 = '#' + Math.floor(Math.random() * 16777216).toString(16).padStart(6, '0');
            document.getElementById('color1').value = color1;
            document.getElementById('color2').value = color2;

            // Génère et affiche la chaîne de paramètres
            updateParamString(D1, E1, color1, D2, E2, color2, angle);

            // Dessine avec les nouvelles valeurs
            drawPlans();
        }

        function updateParamString(D1, E1, color1, D2, E2, color2, angle) {
            const paramString = `${D1}-${E1}-${color1}-${D2}-${E2}-${color2}-${angle}`;
            document.getElementById('paramValues').textContent = paramString;
        }

        function copyToClipboard() {
            const paramString = document.getElementById('paramValues').textContent;
            navigator.clipboard.writeText(paramString).then(() => {
                alert('Paramètres copiés dans le presse-papiers !');
            }).catch(err => {
                console.error('Erreur lors de la copie : ', err);
            });
        }

        // Dessine une première fois au chargement
        drawPlans();
    </script>
</body>
</html>
